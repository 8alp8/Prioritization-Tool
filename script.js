const tasks = [];

// Theme toggle
const themeToggle = document.getElementById('themeToggle');
const lightIcon = themeToggle.querySelector('.light-icon');
const darkIcon = themeToggle.querySelector('.dark-icon');

// ICO formatƒ± kullan
lightIcon.src = 'images/icons/moon-light-mode.ico';
darkIcon.src = 'images/icons/moon-dark - mode.ico';

function toggleTheme() {
  document.body.classList.toggle('dark');
  const isDark = document.body.classList.contains('dark');
  
  // Update theme icon
  const lightIcon = document.querySelector('.light-icon');
  const darkIcon = document.querySelector('.dark-icon');
  lightIcon.style.display = isDark ? 'none' : 'block';
  darkIcon.style.display = isDark ? 'block' : 'none';
  
  // Update all icons
  updateAllIcons();
  
  // Immediately update the graph
  updateMatrix();
  
  // Save preferences
  saveUserPreferences();
}

themeToggle.addEventListener('click', toggleTheme);

// Language support
const langSelect = document.getElementById('langSelect');
const translations = {
  tr: {
    pageTitle: "G√∂rev √ñnceliklendirme Aracƒ±",
    mainTitle: "Eisenhower G√∂rev √ñnceliklendirme Aracƒ±",
    mainSlogan: "√ñnceliklerinizi kolayca y√∂netin, verimliliƒüinizi artƒ±rƒ±n.",
    mainDesc: 'G√∂revlerinizi aciliyet ve √∂nem derecelerine g√∂re √∂nceliklendirin.',
    taskListTitle: 'G√∂rev Listesi',
    addTaskBtn: 'Ekle',
    priorityTitle: '√ñncelik Sƒ±ralamasƒ±',
    graphTitle: 'G√∂rev Daƒüƒ±lƒ±m Grafiƒüi',
    urgency: 'Aciliyet',
    importance: '√ñnem',
    highPriority: '≈ûimdi Yap',
    mediumPriority: 'Planla',
    lowPriority: 'Yok Et',
    immediately: 'Delege Et',
    soon: 'Yakƒ±nda',
    planned: 'Planlanabilir',
    canWait: 'Bekleyebilir',
    critical: 'Kritik',
    important: '√ñnemli',
    medium: 'Orta D√ºzey',
    unimportant: '√ñnemsiz',
    editTask: 'D√ºzenle',
    newTaskPlaceholder: 'Yeni g√∂rev girin',
    deleteConfirm: 'Bu g√∂revi silmek istediƒüinizden emin misiniz?',
    deleteConfirmTitle: 'G√∂revi Sil',
    deleteConfirmYes: 'Evet, Sil',
    deleteConfirmNo: 'Hayƒ±r, ƒ∞ptal',
    sliderLabels: {
      urgency: {
        8: '√áok Acil',
        5: 'Acil',
        3: 'Orta',
        1: 'D√º≈ü√ºk'
      },
      importance: {
        8: '√áok √ñnemli',
        5: '√ñnemli',
        3: 'Orta D√ºzey',
        1: '√ñnemsiz'
      }
    },
    clearAllBtn: 'T√ºm G√∂revleri Temizle',
    clearAllConfirm: 'T√ºm g√∂revleri silmek istediƒüinizden emin misiniz?',
    clearAllYes: 'Evet, T√ºm√ºn√º Sil',
    clearAllNo: 'Hayƒ±r, ƒ∞ptal',
    regionBoxes: {
      plan: {
        title: "Planla",
        importance: "‚≠ê √ñnem: 8-10",
        items: [
          "√ñnemli ama acil deƒüil",
          "Planlanmalƒ±"
        ]
      },
      doNow: {
        title: "Hemen Yap",
        urgency: "üî• Aciliyet: 8-10",
        items: [
          "Acil ve √∂nemli g√∂revler",
          "Hemen yapƒ±lmalƒ±"
        ]
      },
      delete: {
        title: "Sil/Ertele",
        importance: "‚≠ê √ñnem: 1-4",
        items: [
          "Ne acil ne √∂nemli",
          "ƒ∞ptal edilebilir"
        ]
      },
      delegate: {
        title: "Delege Et",
        urgency: "üî• Aciliyet: 5-7",
        items: [
          "Acil ama √∂nemsiz",
          "Ba≈ükasƒ±na devredilebilir"
        ]
      }
    },
    regionExplanations: {
      '1': '≈ûimdi Yap',
      '2': 'Planla',
      '3': 'Delege Et',
      '4': 'Sil'
    },
    regionDescriptions: {
      '1': 'Bu g√∂rev √ßok √∂nemli ve √ßok acil. Hemen yapmalƒ±sƒ±n!',
      '2': 'Bu g√∂rev √∂nemli ama acil deƒüil. Plan yap ve zaman ayƒ±r.',
      '3': 'Bu g√∂rev acil ama √ßok √∂nemli deƒüil. Ba≈ükasƒ±na devretmeyi d√º≈ü√ºn.',
      '4': 'Bu g√∂rev ne acil ne de √∂nemli. Sil veya g√∂z ardƒ± et.'
    }
  },
  en: {
    pageTitle: "Task Prioritization Tool",
    mainTitle: "Eisenhower Task Prioritization Tool",
    mainSlogan: "Easily manage your priorities, increase your productivity.",
    mainDesc: 'Prioritize your tasks by urgency and importance.',
    taskListTitle: 'Task List',
    addTaskBtn: 'Add',
    priorityTitle: 'Priority Ranking',
    graphTitle: 'Task Distribution Matrix',
    urgency: 'Urgency',
    importance: 'Importance',
    highPriority: 'Do Now',
    mediumPriority: 'Plan',
    lowPriority: 'Eliminate',
    immediately: 'Delegate',
    soon: 'Soon',
    planned: 'Can be planned',
    canWait: 'Can wait',
    critical: 'Critical',
    important: 'Important',
    medium: 'Medium',
    unimportant: 'Unimportant',
    editTask: 'Edit',
    newTaskPlaceholder: 'Enter new task',
    deleteConfirm: 'Are you sure you want to delete this task?',
    deleteConfirmTitle: 'Delete Task',
    deleteConfirmYes: 'Yes, Delete',
    deleteConfirmNo: 'No, Cancel',
    sliderLabels: {
      urgency: {
        8: 'Very Urgent',
        5: 'Urgent',
        3: 'Medium',
        1: 'Low'
      },
      importance: {
        8: 'Very Important',
        5: 'Important',
        3: 'Medium',
        1: 'Unimportant'
      }
    },
    clearAllBtn: 'Clear All Tasks',
    clearAllConfirm: 'Are you sure you want to delete all tasks?',
    clearAllYes: 'Yes, Delete All',
    clearAllNo: 'No, Cancel',
    regionBoxes: {
      plan: {
        title: "Plan",
        importance: "‚≠ê Importance: 8-10",
        items: [
          "Important but not urgent",
          "Should be planned"
        ]
      },
      doNow: {
        title: "Do Now",
        urgency: "üî• Urgency: 8-10",
        items: [
          "Urgent and important tasks",
          "Must be done immediately"
        ]
      },
      delete: {
        title: "Delete/Postpone",
        importance: "‚≠ê Importance: 1-4",
        items: [
          "Neither urgent nor important",
          "Can be cancelled"
        ]
      },
      delegate: {
        title: "Delegate",
        urgency: "üî• Urgency: 5-7",
        items: [
          "Urgent but not important",
          "Can be delegated"
        ]
      }
    },
    regionExplanations: {
      '1': 'Do Now',
      '2': 'Plan',
      '3': 'Delegate',
      '4': 'Delete'
    },
    regionDescriptions: {
      '1': 'This task is very important and urgent. Do it now!',
      '2': 'This task is important but not urgent. Plan and schedule it.',
      '3': 'This task is urgent but not very important. Consider delegating.',
      '4': 'This task is neither urgent nor important. Delete or ignore it.'
    }
  },
  de: {
    pageTitle: "Aufgaben-Priorisierungstool",
    mainTitle: "Eisenhower Aufgaben-Priorisierungstool",
    mainSlogan: "Verwalten Sie Ihre Priorit√§ten einfach und steigern Sie Ihre Produktivit√§t.",
    mainDesc: 'Priorisieren Sie Ihre Aufgaben nach Dringlichkeit und Wichtigkeit.',
    taskListTitle: 'Aufgabenliste',
    addTaskBtn: '+',
    priorityTitle: 'Priorit√§tenreihenfolge',
    graphTitle: 'Aufgabenverteilung',
    urgency: 'Dringlichkeit',
    importance: 'Wichtigkeit',
    highPriority: 'Jetzt erledigen',
    mediumPriority: 'Planen',
    lowPriority: 'Eliminieren',
    immediately: 'Delegieren',
    soon: 'Bald',
    planned: 'Kann geplant werden',
    canWait: 'Kann warten',
    critical: 'Kritisch',
    important: 'Wichtig',
    medium: 'Mittel',
    unimportant: 'Unwichtig',
    editTask: 'Bearbeiten',
    newTaskPlaceholder: 'Neue Aufgabe eingeben',
    deleteConfirm: 'Sind Sie sicher, dass Sie diese Aufgabe l√∂schen m√∂chten?',
    deleteConfirmTitle: 'Aufgabe l√∂schen',
    deleteConfirmYes: 'Ja, l√∂schen',
    deleteConfirmNo: 'Nein, abbrechen',
    sliderLabels: {
      urgency: {
        8: 'Sehr dringend',
        5: 'Dringend',
        3: 'Mittel',
        1: 'Niedrig'
      },
      importance: {
        8: 'Sehr wichtig',
        5: 'Wichtig',
        3: 'Mittel',
        1: 'Unwichtig'
      }
    },
    clearAllBtn: 'Alle Aufgaben l√∂schen',
    clearAllConfirm: 'Sind Sie sicher, dass Sie alle Aufgaben l√∂schen m√∂chten?',
    clearAllYes: 'Ja, l√∂schen',
    clearAllNo: 'Nein, abbrechen',
    regionBoxes: {
      plan: {
        title: "Planen",
        importance: "‚≠ê Wichtigkeit: 8-10",
        items: [
          "Wichtig aber nicht dringend",
          "Sollte geplant werden"
        ]
      },
      doNow: {
        title: "Sofort Erledigen",
        urgency: "üî• Dringlichkeit: 8-10",
        items: [
          "Dringende und wichtige Aufgaben",
          "Muss sofort erledigt werden"
        ]
      },
      delete: {
        title: "L√∂schen/Verschieben",
        importance: "‚≠ê Wichtigkeit: 1-4",
        items: [
          "Weder dringend no wichtig",
          "Kann gestrichen werden"
        ]
      },
      delegate: {
        title: "Delegieren",
        urgency: "üî• Dringlichkeit: 5-7",
        items: [
          "Dringend aber nicht wichtig",
          "Kann delegiert werden"
        ]
      }
    },
    regionExplanations: {
      '1': 'Jetzt Machen',
      '2': 'Planen',
      '3': 'Delegieren',
      '4': 'L√∂schen'
    },
    regionDescriptions: {
      '1': 'Diese Aufgabe ist sehr wichtig und dringend. Jetzt erledigen!',
      '2': 'Diese Aufgabe ist wichtig, aber nicht dringend. Plane sie ein.',
      '3': 'Diese Aufgabe ist dringend, aber nicht sehr wichtig. Delegiere sie.',
      '4': 'Diese Aufgabe ist weder dringend no wichtig. L√∂sche oder ignoriere sie.'
    }
  },
  es: {
    pageTitle: "Herramienta de Priorizaci√≥n de Tareas",
    mainTitle: "Herramienta de Priorizaci√≥n de Tareas Eisenhower",
    mainSlogan: "Gestiona f√°cilmente tus prioridades, aumenta tu productividad.",
    mainDesc: 'Prioriza tus tareas por urgencia e importancia.',
    taskListTitle: 'Lista de Tareas',
    addTaskBtn: 'A√±adir',
    priorityTitle: 'Clasificaci√≥n de Prioridades',
    graphTitle: 'Matriz de Distribuci√≥n de Tareas',
    urgency: 'Urgencia',
    importance: 'Importancia',
    highPriority: 'Hacer Ahora',
    mediumPriority: 'Planificar',
    lowPriority: 'Eliminar',
    immediately: 'Delegar',
    soon: 'Pronto',
    planned: 'Puede planificarse',
    canWait: 'Puede esperar',
    critical: 'Cr√≠tico',
    important: 'Importante',
    medium: 'Medio',
    unimportant: 'Sin importancia',
    editTask: 'Editar',
    newTaskPlaceholder: 'Ingrese nueva tarea',
    deleteConfirm: '¬øEst√° seguro de que desea eliminar esta tarea?',
    deleteConfirmTitle: 'Eliminar Tarea',
    deleteConfirmYes: 'S√≠, Eliminar',
    deleteConfirmNo: 'No, Cancelar',
    sliderLabels: {
      urgency: {
        8: 'Muy urgente',
        5: 'Urgente',
        3: 'Media',
        1: 'Baja'
      },
      importance: {
        8: 'Muy importante',
        5: 'Importante',
        3: 'Media',
        1: 'Sin importancia'
      }
    },
    clearAllBtn: 'Borrar Todas las Tareas',
    clearAllConfirm: '¬øEst√° seguro de que desea eliminar todas las tareas?',
    clearAllYes: 'S√≠, Eliminar Todo',
    clearAllNo: 'No, Cancelar',
    regionBoxes: {
      plan: {
        title: "Planificar",
        importance: "‚≠ê Importancia: 8-10",
        items: [
          "Importante pero no urgente",
          "Debe planificarse"
        ]
      },
      doNow: {
        title: "Hacer Ahora",
        urgency: "üî• Urgencia: 8-10",
        items: [
          "Tareas urgentes e importantes",
          "Debe hacerse inmediatamente"
        ]
      },
      delete: {
        title: "Eliminar/Posponer",
        importance: "‚≠ê Importancia: 1-4",
        items: [
          "Ni urgente ni importante",
          "Puede cancelarse"
        ]
      },
      delegate: {
        title: "Delegar",
        urgency: "üî• Urgencia: 5-7",
        items: [
          "Urgente pero no importante",
          "Puede delegarse"
        ]
      }
    },
    regionExplanations: {
      '1': 'Hacer Ahora',
      '2': 'Planificar',
      '3': 'Delegar',
      '4': 'Eliminar'
    },
    regionDescriptions: {
      '1': 'Esta tarea es muy importante y urgente. ¬°Hazla ahora!',
      '2': 'Esta tarea es importante pero no urgente. Planif√≠cala.',
      '3': 'Esta tarea es urgente pero no muy importante. Considera delegarla.',
      '4': 'Esta tarea no es urgente ni importante. Elim√≠nala o ign√≥rala.'
    }
  },
  fr: {
    pageTitle: "Outil de Priorisation des T√¢ches",
    mainTitle: "Outil de Priorisation des T√¢ches Eisenhower",
    mainSlogan: "G√©rez facilement vos priorit√©s, augmentez votre productivit√©.",
    mainDesc: 'Priorisez vos t√¢ches selon l\'urgence et l\'importance.',
    taskListTitle: 'Liste des t√¢ches',
    addTaskBtn: 'Ajouter',
    priorityTitle: 'Classement des priorit√©s',
    graphTitle: 'Matrice de r√©partition des t√¢ches',
    urgency: 'Urgence',
    importance: 'Importance',
    highPriority: 'Faire maintenant',
    mediumPriority: 'Planifier',
    lowPriority: '√âliminer',
    immediately: 'D√©l√©guer',
    soon: 'Bient√¥t',
    planned: 'Peut √™tre planifi√©',
    canWait: 'Peut attendre',
    critical: 'Critique',
    important: 'Important',
    medium: 'Moyen',
    unimportant: 'Sans importance',
    editTask: 'Modifier',
    newTaskPlaceholder: 'Entrez une nouvelle t√¢che',
    deleteConfirm: '√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?',
    deleteConfirmTitle: 'Supprimer la t√¢che',
    deleteConfirmYes: 'Oui, supprimer',
    deleteConfirmNo: 'Non, annuler',
    sliderLabels: {
      urgency: {
        8: 'Tr√®s urgent',
        5: 'Urgent',
        3: 'Moyenne',
        1: 'Faible'
      },
      importance: {
        8: 'Tr√®s important',
        5: 'Important',
        3: 'Moyenne',
        1: 'Peu important'
      }
    },
    clearAllBtn: 'Effacer toutes les t√¢ches',
    clearAllConfirm: '√ätes-vous s√ªr de vouloir supprimer toutes les t√¢ches ?',
    clearAllYes: 'Oui, supprimer',
    clearAllNo: 'Non, annuler',
    regionBoxes: {
      plan: {
        title: "Planifier",
        importance: "‚≠ê Importance: 8-10",
        items: [
          "Important mais pas urgent",
          "Doit √™tre planifi√©"
        ]
      },
      doNow: {
        title: "Faire Maintenant",
        urgency: "üî• Urgence: 8-10",
        items: [
          "T√¢ches urgentes et importantes",
          "Doit √™tre fait imm√©diatement"
        ]
      },
      delete: {
        title: "Supprimer/Reporter",
        importance: "‚≠ê Importance: 1-4",
        items: [
          "Ni urgent ni important",
          "Peut √™tre annul√©"
        ]
      },
      delegate: {
        title: "D√©l√©guer",
        urgency: "üî• Urgence: 5-7",
        items: [
          "Urgent mais pas important",
          "Peut √™tre d√©l√©gu√©"
        ]
      }
    },
    regionExplanations: {
      '1': 'Faire Maintenant',
      '2': 'Planifier',
      '3': 'D√©l√©guer',
      '4': 'Supprimer'
    },
    regionDescriptions: {
      '1': 'Cette t√¢che est tr√®s importante et urgente. Faites-la maintenant!',
      '2': 'Cette t√¢che est importante mais pas urgente. Planifiez-la.',
      '3': 'Cette t√¢che est urgente mais pas tr√®s importante. D√©l√©guez-la.',
      '4': "Cette t√¢che n'est ni urgente ni importante. Supprimez-la ou ignorez-la."
    }
  },
  zh: {
    pageTitle: "‰ªªÂä°‰ºòÂÖàÁ∫ßÂ∑•ÂÖ∑",
    mainTitle: "ËâæÊ£ÆË±™Â®ÅÂ∞î‰ªªÂä°‰ºòÂÖàÁ∫ßÂ∑•ÂÖ∑",
    mainSlogan: "ËΩªÊùæÁÆ°ÁêÜÊÇ®ÁöÑ‰ºòÂÖàÁ∫ßÔºåÊèêÈ´òÊÇ®ÁöÑÁîü‰∫ßÂäõ„ÄÇ",
    mainDesc: 'Ê†πÊçÆÁ¥ßÊÄ•ÊÄßÂíåÈáçË¶ÅÊÄßÂØπ‰ªªÂä°ËøõË°å‰ºòÂÖàÁ∫ßÊéíÂ∫è„ÄÇ',
    taskListTitle: '‰ªªÂä°ÂàóË°®',
    addTaskBtn: 'Ê∑ªÂä†',
    priorityTitle: '‰ºòÂÖàÁ∫ßÊéíÂ∫è',
    graphTitle: '‰ªªÂä°ÂàÜÂ∏ÉÁü©Èòµ',
    urgency: 'Á¥ßÊÄ•ÊÄß',
    importance: 'ÈáçË¶ÅÊÄß',
    highPriority: 'Á´ãÂç≥ÊâßË°å',
    mediumPriority: 'ËßÑÂàí',
    lowPriority: 'Ê∂àÈô§',
    immediately: 'ÂßîÊâò',
    soon: 'Â∞ΩÂø´',
    planned: 'ÂèØ‰ª•ËÆ°Âàí',
    canWait: 'ÂèØ‰ª•Á≠âÂæÖ',
    critical: 'ÂÖ≥ÈîÆ',
    important: 'ÈáçË¶Å',
    medium: '‰∏≠Á≠â',
    unimportant: '‰∏çÈáçË¶Å',
    editTask: 'ÁºñËæë',
    newTaskPlaceholder: 'ËæìÂÖ•Êñ∞‰ªªÂä°',
    deleteConfirm: 'Á°ÆÂÆöË¶ÅÂà†Èô§Ê≠§‰ªªÂä°ÂêóÔºü',
    deleteConfirmTitle: 'Âà†Èô§‰ªªÂä°',
    deleteConfirmYes: 'ÊòØÁöÑÔºåÂà†Èô§',
    deleteConfirmNo: '‰∏çÔºåÂèñÊ∂à',
    sliderLabels: {
      urgency: {
        8: 'ÈùûÂ∏∏Á¥ßÊÄ•',
        5: 'Á¥ßÊÄ•',
        3: '‰∏≠Á≠â',
        1: '‰Ωé'
      },
      importance: {
        8: 'ÈùûÂ∏∏ÈáçË¶Å',
        5: 'ÈáçË¶Å',
        3: '‰∏≠Á≠â',
        1: '‰∏çÈáçË¶Å'
      }
    },
    clearAllBtn: 'Ê∏ÖÈô§ÊâÄÊúâ‰ªªÂä°',
    clearAllConfirm: 'Á°ÆÂÆöË¶ÅÂà†Èô§ÊâÄÊúâ‰ªªÂä°ÂêóÔºü',
    clearAllYes: 'ÊòØÁöÑÔºåÂà†Èô§ÊâÄÊúâ',
    clearAllNo: '‰∏çÔºåÂèñÊ∂à',
    regionBoxes: {
      plan: {
        title: "ËÆ°Âàí",
        importance: "‚≠ê ÈáçË¶ÅÂ∫¶: 8-10",
        items: [
          "ÈáçË¶Å‰ΩÜ‰∏çÁ¥ßÊÄ•",
          "ÈúÄË¶ÅËÆ°Âàí"
        ]
      },
      doNow: {
        title: "Á´ãÂç≥ÊâßË°å",
        urgency: "üî• Á¥ßÊÄ•Â∫¶: 8-10",
        items: [
          "Á¥ßÊÄ•‰∏îÈáçË¶ÅÁöÑ‰ªªÂä°",
          "ÂøÖÈ°ªÁ´ãÂç≥ÂÆåÊàê"
        ]
      },
      delete: {
        title: "Âà†Èô§/Êé®Ëøü",
        importance: "‚≠ê ÈáçË¶ÅÂ∫¶: 1-4",
        items: [
          "Êó¢‰∏çÁ¥ßÊÄ•‰πü‰∏çÈáçË¶Å",
          "ÂèØ‰ª•ÂèñÊ∂à"
        ]
      },
      delegate: {
        title: "ÂßîÊ¥æ",
        urgency: "üî• Á¥ßÊÄ•Â∫¶: 5-7",
        items: [
          "Á¥ßÊÄ•‰ΩÜ‰∏çÈáçË¶Å",
          "ÂèØ‰ª•ÂßîÊ¥æ‰ªñ‰∫∫"
        ]
      }
    },
    regionExplanations: {
      '1': 'Á´ãÂç≥ÊâßË°å',
      '2': 'ËÆ°Âàí',
      '3': 'ÂßîÊ¥æ',
      '4': 'Âà†Èô§'
    },
    regionDescriptions: {
      '1': 'Ê≠§‰ªªÂä°ÈùûÂ∏∏ÈáçË¶Å‰∏îÁ¥ßÊÄ•„ÄÇÁé∞Âú®Â∞±ÂÅöÔºÅ',
      '2': 'Ê≠§‰ªªÂä°ÈáçË¶Å‰ΩÜ‰∏çÁ¥ßÊÄ•„ÄÇËØ∑ËÆ°ÂàíÂÆâÊéí„ÄÇ',
      '3': 'Ê≠§‰ªªÂä°Á¥ßÊÄ•‰ΩÜ‰∏çÂ§™ÈáçË¶Å„ÄÇËÄÉËôëÂßîÊ¥æ„ÄÇ',
      '4': 'Ê≠§‰ªªÂä°Êó¢‰∏çÁ¥ßÊÄ•‰πü‰∏çÈáçË¶Å„ÄÇËØ∑Âà†Èô§ÊàñÂøΩÁï•„ÄÇ'
    }
  },
  ja: {
    pageTitle: "„Çø„Çπ„ÇØÂÑ™ÂÖàÈ†Ü‰Ωç‰ªò„Åë„ÉÑ„Éº„É´",
    mainTitle: "„Ç¢„Ç§„Çº„É≥„Éè„ÉØ„Éº„Çø„Çπ„ÇØÂÑ™ÂÖàÈ†Ü‰Ωç‰ªò„Åë„ÉÑ„Éº„É´",
    mainSlogan: "ÂÑ™ÂÖàÈ†Ü‰Ωç„ÇíÁ∞°Âçò„Å´ÁÆ°ÁêÜ„Åó„ÄÅÁîüÁî£ÊÄß„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜ„ÄÇ",
    mainDesc: 'Á∑äÊÄ•Â∫¶„Å®ÈáçË¶ÅÂ∫¶„Åß„Çø„Çπ„ÇØ„Å´ÂÑ™ÂÖàÈ†Ü‰Ωç„Çí‰ªò„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ',
    taskListTitle: '„Çø„Çπ„ÇØ„É™„Çπ„Éà',
    addTaskBtn: 'ËøΩÂä†',
    priorityTitle: 'ÂÑ™ÂÖàÈ†Ü‰Ωç„É™„Çπ„Éà',
    graphTitle: '„Çø„Çπ„ÇØÂàÜÂ∏É„Éû„Éà„É™„ÉÉ„ÇØ„Çπ',
    urgency: 'Á∑äÊÄ•Â∫¶',
    importance: 'ÈáçË¶ÅÂ∫¶',
    highPriority: '‰ªä„Åô„ÅêÂÆüË°å',
    mediumPriority: 'Ë®àÁîª„Åô„Çã',
    lowPriority: 'ÊéíÈô§„Åô„Çã',
    immediately: 'Âßî‰ªª„Åô„Çã',
    soon: 'ËøëÊó•‰∏≠',
    planned: 'Ë®àÁîªÂèØËÉΩ',
    canWait: 'ÂæÖÊ©üÂèØËÉΩ',
    critical: 'ÈáçË¶Å',
    important: 'ÈáçË¶Å',
    medium: '‰∏≠Á®ãÂ∫¶',
    unimportant: 'ÈáçË¶Å„Åß„Å™„ÅÑ',
    editTask: 'Á∑®ÈõÜ',
    newTaskPlaceholder: 'Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ',
    deleteConfirm: '„Åì„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü',
    deleteConfirmTitle: '„Çø„Çπ„ÇØ„ÅÆÂâäÈô§',
    deleteConfirmYes: '„ÅØ„ÅÑ„ÄÅÂâäÈô§„Åô„Çã',
    deleteConfirmNo: '„ÅÑ„ÅÑ„Åà„ÄÅ„Ç≠„É£„É≥„Çª„É´',
    sliderLabels: {
      urgency: {
        8: 'ÈùûÂ∏∏„Å´Á∑äÊÄ•',
        5: 'Á∑äÊÄ•',
        3: '‰∏≠Á®ãÂ∫¶',
        1: '‰Ωé„ÅÑ'
      },
      importance: {
        8: 'ÈùûÂ∏∏„Å´ÈáçË¶Å',
        5: 'ÈáçË¶Å',
        3: '‰∏≠Á®ãÂ∫¶',
        1: 'ÈáçË¶Å„Åß„Å™„ÅÑ'
      }
    },
    clearAllBtn: '„Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§',
    clearAllConfirm: '„Åô„Åπ„Å¶„ÅÆ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü',
    clearAllYes: '„ÅØ„ÅÑ„ÄÅ„Åô„Åπ„Å¶ÂâäÈô§',
    clearAllNo: '„ÅÑ„ÅÑ„Åà„ÄÅ„Ç≠„É£„É≥„Çª„É´',
    regionBoxes: {
      plan: {
        title: "Ë®àÁîª",
        importance: "‚≠ê ÈáçË¶ÅÂ∫¶: 8-10",
        items: [
          "ÈáçË¶Å„Å†„ÅåÁ∑äÊÄ•„Åß„ÅØ„Å™„ÅÑ",
          "Ë®àÁîª„ÇíÁ´ã„Å¶„ÇãÂøÖË¶Å„ÅÇ„Çä"
        ]
      },
      doNow: {
        title: "‰ªä„Åô„ÅêÂÆüË°å",
        urgency: "üî• Á∑äÊÄ•Â∫¶: 8-10",
        items: [
          "Á∑äÊÄ•„Åã„Å§ÈáçË¶Å„Å™„Çø„Çπ„ÇØ",
          "„Åô„Åê„Å´ÂÆüË°å„Åô„ÇãÂøÖË¶Å„ÅÇ„Çä"
        ]
      },
      delete: {
        title: "ÂâäÈô§/Âª∂Êúü",
        importance: "‚≠ê ÈáçË¶ÅÂ∫¶: 1-4",
        items: [
          "Á∑äÊÄ•„Åß„ÇÇÈáçË¶Å„Åß„ÇÇ„Å™„ÅÑ",
          "„Ç≠„É£„É≥„Çª„É´ÂèØËÉΩ"
        ]
      },
      delegate: {
        title: "Âßî‰ªª",
        urgency: "üî• Á∑äÊÄ•Â∫¶: 5-7",
        items: [
          "Á∑äÊÄ•„Å†„ÅåÈáçË¶Å„Åß„ÅØ„Å™„ÅÑ",
          "Âßî‰ªªÂèØËÉΩ"
        ]
      }
    },
    regionExplanations: {
      '1': '‰ªä„Åô„ÅêÂÆüË°å',
      '2': 'Ë®àÁîª',
      '3': 'Âßî‰ªª',
      '4': 'ÂâäÈô§'
    },
    regionDescriptions: {
      '1': '„Åì„ÅÆ„Çø„Çπ„ÇØ„ÅØÈùûÂ∏∏„Å´ÈáçË¶Å„Åã„Å§Á∑äÊÄ•„Åß„Åô„ÄÇ‰ªä„Åô„ÅêÂÆüË°å„Åó„Åæ„Åó„Çá„ÅÜÔºÅ',
      '2': '„Åì„ÅÆ„Çø„Çπ„ÇØ„ÅØÈáçË¶Å„Åß„Åô„ÅåÁ∑äÊÄ•„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇË®àÁîª„ÇíÁ´ã„Å¶„Åæ„Åó„Çá„ÅÜ„ÄÇ',
      '3': '„Åì„ÅÆ„Çø„Çπ„ÇØ„ÅØÁ∑äÊÄ•„Åß„Åô„Åå„ÅÇ„Åæ„ÇäÈáçË¶Å„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂßî‰ªª„ÇíÊ§úË®é„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ',
      '4': '„Åì„ÅÆ„Çø„Çπ„ÇØ„ÅØÁ∑äÊÄ•„Åß„ÇÇÈáçË¶Å„Åß„ÇÇ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÂâäÈô§„Åæ„Åü„ÅØÁÑ°Ë¶ñ„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ'
    }
  },
  ch: {
    pageTitle: "Aufgaben-Priorisierungstool",
    mainTitle: "Eisenhower Aufgaben-Priorisierungstool",
    mainSlogan: "Verwalte dini Priorit√§te eifach und steigere dini Produktivit√§t.",
    mainDesc: 'Priorisiere dini Ufgabe nach Dringlichkeit und Wichtigkeite.',
    taskListTitle: 'Ufgabenliste',
    addTaskBtn: '+',
    priorityTitle: 'Priorit√§te',
    graphTitle: 'Ufgabenverteilig',
    urgency: 'Dringlichkeit',
    importance: 'Wichtigkeite',
    highPriority: 'Jetzt mache',
    mediumPriority: 'Plane',
    lowPriority: 'Eliminiere',
    immediately: 'Delegiere',
    soon: 'Bald',
    planned: 'Chann gplant werde',
    canWait: 'Chann warte',
    critical: 'Kritisch',
    important: 'Wichtig',
    medium: 'Mittel',
    unimportant: 'Unwichtig',
    editTask: 'Bearbeite',
    newTaskPlaceholder: 'Neui Ufgabe iig√§h',
    deleteConfirm: 'Bisch sicher, dass du die Ufgabe wotsch l√∂sche?',
    deleteConfirmTitle: 'Ufgabe l√∂sche',
    deleteConfirmYes: 'Ja, l√∂sche',
    deleteConfirmNo: 'Nei, abbr√§che',
    sliderLabels: {
      urgency: {
        8: 'Sofort',
        5: 'Bald',
        3: 'Chann gplant werde',
        1: 'Chann warte'
      },
      importance: {
        8: 'Kritisch',
        5: 'Wichtig',
        3: 'Mittel',
        1: 'Unwichtig'
      }
    },
    clearAllBtn: 'Alli Ufgabe l√∂sche',
    clearAllConfirm: 'Bisch sicher, dass du alli Ufgabe wotsch l√∂sche?',
    clearAllYes: 'Ja, alli l√∂sche',
    clearAllNo: 'Nei, abbr√§che',
    regionBoxes: {
      plan: {
        title: "Plane",
        importance: "‚≠ê Wichtigkeite: 8-10",
        items: [
          "Wichtig aber n√∂d dringend",
          "Sott gplant werde"
        ]
      },
      doNow: {
        title: "Jetzt Mache",
        urgency: "üî• Dringlichkeit: 8-10",
        items: [
          "Dringendi und wichtigi Ufgabe",
          "Muss sofort gmacht werde"
        ]
      },
      delete: {
        title: "L√∂sche/Verschiebe",
        importance: "‚≠ê Wichtigkeite: 1-4",
        items: [
          "Weder dringend no wichtig",
          "Chann gstriche werde"
        ]
      },
      delegate: {
        title: "Delegiere",
        urgency: "üî• Dringlichkeit: 5-7",
        items: [
          "Dringend aber n√∂d wichtig",
          "Chann delegiert werde"
        ]
      }
    },
    regionExplanations: {
      '1': 'Jetzt Mache',
      '2': 'Plane',
      '3': 'Delegiere',
      '4': 'L√∂sche'
    },
    regionDescriptions: {
      '1': 'Die Ufgabe isch sehr wichtig und dringend. Mach sie jetzt!',
      '2': 'Die Ufgabe isch wichtig, aber n√∂d dringend. Plane sie.',
      '3': 'Die Ufgabe isch dringend, aber n√∂d sehr wichtig. Delegiere sie.',
      '4': 'Die Ufgabe isch weder dringend no wichtig. L√∂sche oder ignoriere sie.'
    }
  },
  gsw: {
    pageTitle: "Aufgaben-Priorisierungstool",
    mainTitle: "Eisenhower Aufgaben-Priorisierungstool",
    mainSlogan: "Verwalte dini Priorit√§te eifach und steigere dini Produktivit√§t.",
    mainDesc: 'Priorisiere dini Ufgabe nach Dringlichkeit und Wichtigkeite.',
    taskListTitle: 'Ufgabenliste',
    addTaskBtn: '+',
    priorityTitle: 'Priorit√§te',
    graphTitle: 'Ufgabenverteilig',
    urgency: 'Dringlichkeit',
    importance: 'Wichtigkeite',
    highPriority: 'Jetzt mache',
    mediumPriority: 'Plane',
    lowPriority: 'Eliminiere',
    immediately: 'Delegiere',
    soon: 'Bald',
    planned: 'Chann gplant werde',
    canWait: 'Chann warte',
    critical: 'Kritisch',
    important: 'Wichtig',
    medium: 'Mittel',
    unimportant: 'Unwichtig',
    editTask: 'Bearbeite',
    newTaskPlaceholder: 'Neui Ufgabe iig√§h',
    deleteConfirm: 'Bisch sicher, dass du die Ufgabe wotsch l√∂sche?',
    deleteConfirmTitle: 'Ufgabe l√∂sche',
    deleteConfirmYes: 'Ja, l√∂sche',
    deleteConfirmNo: 'Nei, abbr√§che',
    sliderLabels: {
      urgency: {
        8: 'Sofort',
        5: 'Bald',
        3: 'Chann gplant werde',
        1: 'Chann warte'
      },
      importance: {
        8: 'Kritisch',
        5: 'Wichtig',
        3: 'Mittel',
        1: 'Unwichtig'
      }
    },
    clearAllBtn: 'Alli Ufgabe l√∂sche',
    clearAllConfirm: 'Bisch sicher, dass du alli Ufgabe wotsch l√∂sche?',
    clearAllYes: 'Ja, alli l√∂sche',
    clearAllNo: 'Nei, abbr√§che',
    regionBoxes: {
      plan: {
        title: "Plane",
        importance: "‚≠ê Wichtigkeite: 8-10",
        items: [
          "Wichtig aber n√∂d dringend",
          "Sott gplant werde"
        ]
      },
      doNow: {
        title: "Jetzt Mache",
        urgency: "üî• Dringlichkeit: 8-10",
        items: [
          "Dringendi und wichtigi Ufgabe",
          "Muss sofort gmacht werde"
        ]
      },
      delete: {
        title: "L√∂sche/Verschiebe",
        importance: "‚≠ê Wichtigkeite: 1-4",
        items: [
          "Weder dringend no wichtig",
          "Chann gstriche werde"
        ]
      },
      delegate: {
        title: "Delegiere",
        urgency: "üî• Dringlichkeit: 5-7",
        items: [
          "Dringend aber n√∂d wichtig",
          "Chann delegiert werde"
        ]
      }
    },
    regionExplanations: {
      '1': 'Jetzt Mache',
      '2': 'Plane',
      '3': 'Delegiere',
      '4': 'L√∂sche'
    },
    regionDescriptions: {
      '1': 'Die Ufgabe isch sehr wichtig und dringend. Mach sie jetzt!',
      '2': 'Die Ufgabe isch wichtig, aber n√∂d dringend. Plane sie.',
      '3': 'Die Ufgabe isch dringend, aber n√∂d sehr wichtig. Delegiere sie.',
      '4': 'Die Ufgabe isch weder dringend no wichtig. L√∂sche oder ignoriere sie.'
    }
  }
};
langSelect.onchange = function() {
  const lang = langSelect.value;
  const t = translations[lang];
  
  // Update all text elements
  document.getElementById('mainTitle').textContent = t.mainTitle;
  document.getElementById('mainSlogan').textContent = t.mainSlogan;
  document.getElementById('taskListTitle').textContent = t.taskListTitle;
  document.getElementById('addTaskBtn').textContent = t.addTaskBtn;
  document.getElementById('priorityTitle').textContent = t.priorityTitle;
  document.getElementById('graphTitle').textContent = t.graphTitle;
  document.getElementById('taskInput').placeholder = t.newTaskPlaceholder;
  
  // Update existing tasks
  document.querySelectorAll('.task').forEach((taskDiv, index) => {
    const task = tasks[index];
    const strong = taskDiv.querySelector('strong');
    const isDark = document.body.classList.contains('dark');
    const editIcon = isDark ? 'images/icons/pen-dark mode.ico' : 'images/icons/pen-light-mode.ico';
    
    strong.innerHTML = `${task.title} <button class="edit-btn" title="${t.editTask}"><img src="${editIcon}" alt="edit"></button></strong>`;
    
    // Update slider labels
    const urgencyLabel = taskDiv.querySelector('.slider-label:first-child');
    const importanceLabel = taskDiv.querySelector('.slider-label:last-child');
    if (urgencyLabel) urgencyLabel.textContent = `${t.urgency}:`;
    if (importanceLabel) importanceLabel.textContent = `${t.importance}:`;
    
    // Update slider value labels
    const urgencySlider = taskDiv.querySelector('input[type="range"]:first-child');
    const importanceSlider = taskDiv.querySelector('input[type="range"]:last-child');
    if (urgencySlider) {
      const urgencyValueLabel = urgencySlider.parentElement.querySelector('.slider-value-label');
      if (urgencyValueLabel) {
        let val = parseInt(urgencySlider.value);
        let desc = '';
        if (val >= 8) desc = t.sliderLabels.urgency[8];
        else if (val >= 5) desc = t.sliderLabels.urgency[5];
        else if (val >= 3) desc = t.sliderLabels.urgency[3];
        else desc = t.sliderLabels.urgency[1];
        urgencyValueLabel.innerHTML = `<span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400}">${val}</span><span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400};font-size:0.98em;margin-left:0.5em">${desc}</span>`;
      }
    }
    if (importanceSlider) {
      const importanceValueLabel = importanceSlider.parentElement.querySelector('.slider-value-label');
      if (importanceValueLabel) {
        let val = parseInt(importanceSlider.value);
        let desc = '';
        if (val >= 8) desc = t.sliderLabels.importance[8];
        else if (val >= 5) desc = t.sliderLabels.importance[5];
        else if (val >= 3) desc = t.sliderLabels.importance[3];
        else desc = t.sliderLabels.importance[1];
        importanceValueLabel.innerHTML = `<span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400}">${val}</span><span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400};font-size:0.98em;margin-left:0.5em">${desc}</span>`;
      }
    }
  });
  
  // Update priority list
  updatePriorityList();
  
  // Update matrix
  updateMatrix();
  
  // Update clear all button text
  const clearAllBtn = document.querySelector('.btn-main[style*="marginTop"]');
  if (clearAllBtn) {
    clearAllBtn.textContent = t.clearAllBtn;
  }
  
  // Save preferences
  saveUserPreferences();
};

function createSlider(task, type, idx) {
  const wrapper = document.createElement('div');
  wrapper.className = 'slider-wrapper';
  const range = document.createElement('input');
  range.type = 'range';
  range.min = 0;
  range.max = 10;
  range.step = 1;
  range.value = task[type];
  
  // Label row
  const labelRow = document.createElement('div');
  labelRow.className = 'slider-label-row';
  const label = document.createElement('div');
  label.className = 'slider-label';
  const t = translations[langSelect.value];
  label.textContent = `${type === 'urgency' ? t.urgency : t.importance}:`;
  
  // Value + description
  const valueLabel = document.createElement('span');
  valueLabel.className = 'slider-value-label';
  
  function updateSliderLabel() {
    let val = parseInt(range.value);
    let desc = '';
    let weight = 400;
    
    if (type === 'urgency') {
      if (val >= 8) { desc = t.sliderLabels.urgency[8]; weight = 800; }
      else if (val >= 5) { desc = t.sliderLabels.urgency[5]; weight = 600; }
      else if (val >= 3) { desc = t.sliderLabels.urgency[3]; weight = 500; }
      else { desc = t.sliderLabels.urgency[1]; weight = 400; }
    } else {
      if (val >= 8) { desc = t.sliderLabels.importance[8]; weight = 800; }
      else if (val >= 5) { desc = t.sliderLabels.importance[5]; weight = 600; }
      else if (val >= 3) { desc = t.sliderLabels.importance[3]; weight = 500; }
      else { desc = t.sliderLabels.importance[1]; weight = 400; }
    }
    
    // Create separate spans for number and description
    const numberSpan = document.createElement('span');
    numberSpan.style.fontWeight = weight;
    numberSpan.textContent = val;
    
    const descSpan = document.createElement('span');
    descSpan.style.fontWeight = weight;
    descSpan.style.fontSize = '0.98em';
    descSpan.style.marginLeft = '0.5em';
    descSpan.textContent = desc;
    
    // Clear and append new elements
    valueLabel.innerHTML = '';
    valueLabel.appendChild(numberSpan);
    valueLabel.appendChild(descSpan);
  }
  
  updateSliderLabel();
  labelRow.appendChild(label);
  labelRow.appendChild(valueLabel);
  wrapper.appendChild(labelRow);
  wrapper.appendChild(range);
  
  // Update label when slider changes
  range.addEventListener('input', () => {
    task[type] = parseInt(range.value);
    updateThumb();
    updateMatrix();
    updatePriorityList();
    updateSliderLabel();
  });
  
  // Thumb renk ve boyut
  function updateThumb() {
    let val = parseInt(range.value);
    let total = type === 'urgency' ? val + task.importance : val + task.urgency;
    let color = '';
    if (total <= 10) {
      const t = (total) / 10;
      const r = Math.round(162 + (255-162)*t);
      const g = Math.round(89 + (184-89)*t);
      const b = Math.round(198 + (107-198)*t);
      color = `rgb(${r},${g},${b})`;
    } else {
      const t = (total - 10) / 10;
      const r = Math.round(255 + (67-255)*t);
      const g = Math.round(184 + (191-184)*t);
      const b = Math.round(107 + (160-107)*t);
      color = `rgb(${r},${g},${b})`;
    }
    let size = 18 + (val/10)*18; // min 18, max 36
    range.style.setProperty('--thumb-color', color);
    range.style.setProperty('--thumb-size', size+'px');
  }
  range.addEventListener('input', () => {
    task[type] = parseInt(range.value);
    updateThumb();
    updateMatrix();
    updatePriorityList();
    updateSliderLabel();
  });
  // Thumb CSS
  range.style.setProperty('--thumb-color', '#a259c6');
  range.style.setProperty('--thumb-size', '18px');
  range.oninput = updateThumb;
  // Thumb dynamic style
  range.style.setProperty('accent-color', 'var(--primary)');
  range.style.setProperty('background', '#222');
  range.style.setProperty('border-radius', '4px');
  range.style.setProperty('height', '7px');
  range.style.setProperty('outline', 'none');
  range.style.setProperty('margin-bottom', '0.2rem');
  range.style.setProperty('transition', 'background 0.18s');
  range.style.setProperty('box-shadow', '0 2px 6px rgba(44,62,80,0.13)');
  // Custom thumb
  range.addEventListener('input', function() {
    let val = parseInt(range.value);
    let total = type === 'urgency' ? val + task.importance : val + task.urgency;
    let color = '';
    if (total <= 10) {
      const t = (total) / 10;
      const r = Math.round(162 + (255-162)*t);
      const g = Math.round(89 + (184-89)*t);
      const b = Math.round(198 + (107-198)*t);
      color = `rgb(${r},${g},${b})`;
    } else {
      const t = (total - 10) / 10;
      const r = Math.round(255 + (67-255)*t);
      const g = Math.round(184 + (191-184)*t);
      const b = Math.round(107 + (160-107)*t);
      color = `rgb(${r},${g},${b})`;
    }
    let size = 18 + (val/10)*18;
    range.style.setProperty('--thumb-color', color);
    range.style.setProperty('--thumb-size', size+'px');
  });
  // Style for dynamic thumb
  range.style.setProperty('background', '#222');
  range.style.setProperty('height', '7px');
  range.style.setProperty('border-radius', '4px');
  range.style.setProperty('outline', 'none');
  range.style.setProperty('margin-bottom', '0.2rem');
  range.style.setProperty('transition', 'background 0.18s');
  range.style.setProperty('box-shadow', '0 2px 6px rgba(44,62,80,0.13)');
  range.style.setProperty('accent-color', 'var(--primary)');
  // Custom thumb CSS
  range.style.setProperty('appearance', 'none');
  range.style.setProperty('WebkitAppearance', 'none');
  range.style.setProperty('MozAppearance', 'none');
  range.style.setProperty('background', '#222');
  range.style.setProperty('border', 'none');
  range.style.setProperty('outline', 'none');
  range.style.setProperty('box-shadow', '0 2px 6px rgba(44,62,80,0.13)');
  range.style.setProperty('height', '7px');
  // Custom thumb via CSS
  range.style.setProperty('--webkit-slider-thumb', `background: var(--thumb-color); width: var(--thumb-size); height: var(--thumb-size); border-radius: 50%; border: 2px solid #fff;`);
  return wrapper;
}

// Create a reusable edit function
function createEditHandler(task, div, t, editIcon) {
  return function() {
    const inputEdit = document.createElement('input');
    inputEdit.type = 'text';
    inputEdit.value = task.title;
    inputEdit.className = 'edit-input';
    div.classList.add('editing');
    
    const currentStrong = div.querySelector('strong');
    currentStrong.replaceWith(inputEdit);
    inputEdit.focus();
    
    inputEdit.onblur = function() {
      const newTitle = toCapitalizedCase(inputEdit.value.trim());
      if (!newTitle) {
        // If title is empty, delete the task
        const index = tasks.indexOf(task);
        if (index > -1) {
          tasks.splice(index, 1);
          div.remove();
          updateMatrix();
          updatePriorityList();
          saveUserPreferences();
        }
        return;
      }
      
      task.title = newTitle;
      const newStrong = document.createElement('strong');
      newStrong.innerHTML = `${task.title} <button class="edit-btn" title="${t.editTask}"><img src="${editIcon}" alt="edit"></button></strong>`;
      inputEdit.replaceWith(newStrong);
      div.classList.remove('editing');
      
      // Reattach click handler
      const newEditBtn = newStrong.querySelector('.edit-btn');
      newEditBtn.onclick = createEditHandler(task, div, t, editIcon);
      
      saveUserPreferences();
    };
    
    inputEdit.onkeydown = function(e) {
      if (e.key === 'Enter') {
        const newTitle = toCapitalizedCase(inputEdit.value.trim());
        if (!newTitle) {
          // If title is empty, delete the task
          const index = tasks.indexOf(task);
          if (index > -1) {
            tasks.splice(index, 1);
            div.remove();
            updateMatrix();
            updatePriorityList();
            saveUserPreferences();
          }
          return;
        }
        inputEdit.blur();
      }
    };
  };
}

function addTask() {
  const input = document.getElementById('taskInput');
  const title = toCapitalizedCase(input.value.trim());
  if (!title) return;
  const task = { title, urgency: 5, importance: 5 };
  tasks.push(task);
  addTaskCardToUI(task, tasks.length-1);
  input.value = '';
  updateMatrix();
  updatePriorityList();
  saveUserPreferences();
  updateClearAllButtonVisibility();
}

// Function to update clear all button visibility
function updateClearAllButtonVisibility() {
  const clearAllBtn = document.querySelector('.btn-main[style*="marginTop"]');
  if (clearAllBtn) {
    clearAllBtn.style.display = tasks.length >= 2 ? 'block' : 'none';
    clearAllBtn.textContent = translations[langSelect.value].clearAllBtn;
  }
}

function toCapitalizedCase(str) {
  return str.replace(/\w\S*/g, word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase());
}

function updateMatrix() {
  const canvas = document.getElementById('matrixCanvas');
  const ctx = canvas.getContext('2d');
  const padding = 40;
  const graphWidth = canvas.width - (padding * 2);
  const graphHeight = canvas.height - (padding * 2);
  
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Background
  ctx.fillStyle = document.body.classList.contains('dark') ? '#23272f' : '#f7f8fa';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw colored regions
  ctx.globalAlpha = 0.15;
  ctx.fillStyle = '#7be15c'; // Sol √ºst
  ctx.fillRect(padding, padding, graphWidth/2, graphHeight/2);
  ctx.fillStyle = '#ffa64d'; // Saƒü √ºst
  ctx.fillRect(padding + graphWidth/2, padding, graphWidth/2, graphHeight/2);
  ctx.fillStyle = '#2ed0f7'; // Sol alt
  ctx.fillRect(padding, padding + graphHeight/2, graphWidth/2, graphHeight/2);
  ctx.fillStyle = '#ff4d4d'; // Saƒü alt
  ctx.fillRect(padding + graphWidth/2, padding + graphHeight/2, graphWidth/2, graphHeight/2);
  ctx.globalAlpha = 1;
  
  // Draw grid
  ctx.strokeStyle = document.body.classList.contains('dark') ? '#444' : '#e3e6ee';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 10; i++) {
    const x = padding + (i * (graphWidth/10));
    ctx.beginPath();
    ctx.moveTo(x, padding);
    ctx.lineTo(x, padding + graphHeight);
    ctx.stroke();
  }
  for (let i = 0; i <= 10; i++) {
    const y = padding + (i * (graphHeight/10));
    ctx.beginPath();
    ctx.moveTo(padding, y);
    ctx.lineTo(padding + graphWidth, y);
    ctx.stroke();
  }
  
  // Region labels (white in dark mode)
  const t = translations[langSelect.value];
  ctx.save();
  ctx.font = 'bold 18px Montserrat';
  ctx.fillStyle = document.body.classList.contains('dark') ? '#fff' : '#234';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(t.regionExplanations['1'], padding + graphWidth * 0.25, padding + graphHeight * 0.25);
  ctx.fillText(t.regionExplanations['2'], padding + graphWidth * 0.75, padding + graphHeight * 0.25);
  ctx.fillText(t.regionExplanations['3'], padding + graphWidth * 0.25, padding + graphHeight * 0.75);
  ctx.fillText(t.regionExplanations['4'], padding + graphWidth * 0.75, padding + graphHeight * 0.75);
  ctx.restore();
  
  // Eksenler
  ctx.strokeStyle = document.body.classList.contains('dark') ? '#666' : '#bbb';
  ctx.beginPath();
  ctx.moveTo(padding + graphWidth/2, padding);
  ctx.lineTo(padding + graphWidth/2, padding + graphHeight);
  ctx.moveTo(padding, padding + graphHeight/2);
  ctx.lineTo(padding + graphWidth, padding + graphHeight/2);
  ctx.stroke();
  
  // Draw points (urgency reversed)
  tasks.forEach((task, idx) => {
    const x = padding + ((10 - task.urgency) * (graphWidth / 10));
    const y = padding + (graphHeight - (task.importance * (graphHeight/10)));
    ctx.save();
    if (window._highlightedTask === idx) {
      ctx.shadowColor = document.body.classList.contains('dark') ? 'rgba(255, 255, 255, 0.5)' : 'rgba(0, 0, 0, 0.5)';
      ctx.shadowBlur = 18;
    }
    let total = task.urgency + task.importance;
    let color = '';
    if (total <= 10) {
      const t = (total) / 10;
      const r = Math.round(162 + (255-162)*t);
      const g = Math.round(89 + (184-89)*t);
      const b = Math.round(198 + (107-198)*t);
      color = `rgb(${r},${g},${b})`;
    } else {
      const t = (total - 10) / 10;
      const r = Math.round(255 + (67-255)*t);
      const g = Math.round(184 + (191-184)*t);
      const b = Math.round(107 + (160-107)*t);
      color = `rgb(${r},${g},${b})`;
    }
    ctx.beginPath();
    ctx.arc(x, y, 9, 0, Math.PI * 2);
    ctx.fillStyle = color;
    ctx.fill();
    ctx.shadowBlur = 0;
    ctx.font = window._highlightedTask === idx ? 'bold 16px Montserrat' : '14px Montserrat';
    ctx.fillStyle = document.body.classList.contains('dark') ? '#fff' : '#234';
    ctx.fillText(`(${idx+1})`, x+13, y-13);
    ctx.restore();
  });
}

function updatePriorityList() {
  const sorted = [...tasks].map((t, i) => ({...t, _idx: i})).sort((a, b) => (b.urgency + b.importance) - (a.urgency + a.importance));
  const container = document.getElementById('priority');
  container.innerHTML = '';
  const t = translations[langSelect.value];
  
  sorted.forEach((task, i) => {
    const div = document.createElement('div');
    div.className = 'task-card';
    const total = task.urgency + task.importance;
    let comment = '';
    let color = '';
    if (total <= 10) {
      const t = (total) / 10;
      const r = Math.round(162 + (255-162)*t);
      const g = Math.round(89 + (184-89)*t);
      const b = Math.round(198 + (107-198)*t);
      color = `rgb(${r},${g},${b})`;
    } else {
      const t = (total - 10) / 10;
      const r = Math.round(255 + (67-255)*t);
      const g = Math.round(184 + (191-184)*t);
      const b = Math.round(107 + (160-107)*t);
      color = `rgb(${r},${g},${b})`;
    }
    if (total >= 16) comment = t.highPriority;
    else if (total >= 12) comment = t.mediumPriority;
    else comment = t.lowPriority;
    div.innerHTML = `<span class="score-box" style="background:${color}">${task.urgency + task.importance}</span> <strong>${task.title}</strong> <span style="margin-left:0.7em;font-size:0.98em;color:#888;">(${task._idx+1})</span><small>${comment}</small>`;
    div.onmouseenter = () => { window._highlightedTask = task._idx; updateMatrix(); };
    div.onmouseleave = () => { window._highlightedTask = null; updateMatrix(); };
    container.appendChild(div);
  });
}

document.getElementById('regionExplanation').style.display = 'none';
document.getElementById('graphInfoBox').style.display = 'none';

// Enter ile g√∂rev ekleme
document.getElementById('taskInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') addTask();
});

// Update all icons based on current theme
function updateAllIcons() {
  const isDark = document.body.classList.contains('dark');
  const editIcon = isDark ? 'images/icons/pen-dark mode.ico' : 'images/icons/pen-light-mode.ico';
  const trashIcon = isDark ? 'images/icons/trash-can-dark-mode.ico' : 'images/icons/trash-can-light-mode.ico';
  
  document.querySelectorAll('.edit-btn img').forEach(img => {
    img.src = editIcon;
  });
  document.querySelectorAll('.trash-btn img').forEach(img => {
    img.src = trashIcon;
  });
}

// Save user preferences including tasks
function saveUserPreferences() {
  const preferences = {
    language: langSelect.value,
    theme: document.body.classList.contains('dark') ? 'dark' : 'light',
    tasks: tasks
  };
  localStorage.setItem('userPreferences', JSON.stringify(preferences));
}

// Load user preferences and tasks from localStorage
function loadUserPreferences() {
  const savedPreferences = JSON.parse(localStorage.getItem('userPreferences')) || {};
  // Load theme
  if (savedPreferences.theme === 'dark') {
    document.body.classList.add('dark');
  } else {
    document.body.classList.remove('dark');
  }
  // Load language
  if (savedPreferences.language) {
    langSelect.value = savedPreferences.language;
  }
  // Load tasks
  if (savedPreferences.tasks && Array.isArray(savedPreferences.tasks)) {
    tasks.length = 0;
    document.getElementById('tasks').innerHTML = '';
    savedPreferences.tasks.forEach(task => {
      tasks.push(task);
      addTaskCardToUI(task, tasks.length-1);
    });
    updateMatrix();
    updatePriorityList();
    updateClearAllButtonVisibility();
  }
}

// Set default language to Turkish when page loads
document.addEventListener('DOMContentLoaded', function() {
  const langSelect = document.getElementById('langSelect');
  langSelect.value = 'tr';
  updateTranslations();
});

// Custom Alert Function
function showCustomAlert(message, onConfirm) {
  const alert = document.getElementById('customAlert');
  const alertMessage = document.getElementById('alertMessage');
  const confirmBtn = document.getElementById('confirmBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const closeBtn = document.getElementById('closeAlert');
  const t = translations[langSelect.value];

  alertMessage.textContent = message;
  confirmBtn.textContent = message.includes('t√ºm') ? t.clearAllYes : t.deleteConfirmYes;
  cancelBtn.textContent = message.includes('t√ºm') ? t.clearAllNo : t.deleteConfirmNo;
  alert.style.display = 'flex';

  const closeAlert = () => {
    alert.style.display = 'none';
  };

  confirmBtn.onclick = () => {
    closeAlert();
    onConfirm();
  };

  cancelBtn.onclick = closeAlert;
  closeBtn.onclick = closeAlert;
}

// Update event listeners
document.addEventListener('DOMContentLoaded', function() {
  // Initialize theme icons
  const lightIcon = document.querySelector('.light-icon');
  const darkIcon = document.querySelector('.dark-icon');
  
  // Theme toggle
  const themeToggle = document.getElementById('themeToggle');
  themeToggle.addEventListener('click', toggleTheme);
  
  // Create clear all button
  const taskListSection = document.querySelector('.task-list');
  const clearAllBtn = document.createElement('button');
  clearAllBtn.className = 'btn-main';
  clearAllBtn.style.marginTop = '1rem';
  clearAllBtn.style.display = 'none'; // Initially hidden
  clearAllBtn.onclick = function() {
    const t = translations[langSelect.value];
    showCustomAlert(t.clearAllConfirm, () => {
      tasks.length = 0;
      document.getElementById('tasks').innerHTML = '';
      updateMatrix();
      updatePriorityList();
      saveUserPreferences();
      updateClearAllButtonVisibility();
    });
  };
  taskListSection.appendChild(clearAllBtn);
  
  // Load saved preferences
  loadUserPreferences();
  
  // Language change
  langSelect.addEventListener('change', function() {
    updateTranslations();
    // Immediately update all task elements
    document.querySelectorAll('.task').forEach((taskDiv, index) => {
      const task = tasks[index];
      const strong = taskDiv.querySelector('strong');
      const t = translations[langSelect.value];
      const isDark = document.body.classList.contains('dark');
      const editIcon = isDark ? 'images/icons/pen-dark mode.ico' : 'images/icons/pen-light-mode.ico';
      
      strong.innerHTML = `${task.title} <button class="edit-btn" title="${t.editTask}"><img src="${editIcon}" alt="edit"></button></strong>`;
      
      // Update slider labels
      const urgencyLabel = taskDiv.querySelector('.slider-label:first-child');
      const importanceLabel = taskDiv.querySelector('.slider-label:last-child');
      if (urgencyLabel) urgencyLabel.textContent = `${t.urgency}:`;
      if (importanceLabel) importanceLabel.textContent = `${t.importance}:`;
      
      // Update slider value labels
      const urgencySlider = taskDiv.querySelector('input[type="range"]:first-child');
      const importanceSlider = taskDiv.querySelector('input[type="range"]:last-child');
      if (urgencySlider) {
        const urgencyValueLabel = urgencySlider.parentElement.querySelector('.slider-value-label');
        if (urgencyValueLabel) {
          let val = parseInt(urgencySlider.value);
          let desc = '';
          if (val >= 8) desc = t.sliderLabels.urgency[8];
          else if (val >= 5) desc = t.sliderLabels.urgency[5];
          else if (val >= 3) desc = t.sliderLabels.urgency[3];
          else desc = t.sliderLabels.urgency[1];
          urgencyValueLabel.innerHTML = `<span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400}">${val}</span><span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400};font-size:0.98em;margin-left:0.5em">${desc}</span>`;
        }
      }
      if (importanceSlider) {
        const importanceValueLabel = importanceSlider.parentElement.querySelector('.slider-value-label');
        if (importanceValueLabel) {
          let val = parseInt(importanceSlider.value);
          let desc = '';
          if (val >= 8) desc = t.sliderLabels.importance[8];
          else if (val >= 5) desc = t.sliderLabels.importance[5];
          else if (val >= 3) desc = t.sliderLabels.importance[3];
          else desc = t.sliderLabels.importance[1];
          importanceValueLabel.innerHTML = `<span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400}">${val}</span><span style="font-weight:${val >= 8 ? 800 : val >= 5 ? 600 : val >= 3 ? 500 : 400};font-size:0.98em;margin-left:0.5em">${desc}</span>`;
        }
      }
    });
    
    // Update priority list
    updatePriorityList();
    
    // Update matrix
    updateMatrix();
    
    // Update clear all button text
    const clearAllBtn = document.querySelector('.btn-main[style*="marginTop"]');
    if (clearAllBtn) {
      clearAllBtn.textContent = translations[langSelect.value].clearAllBtn;
    }
    
    // Update intro text
    document.querySelector('.intro h1').textContent = translations[langSelect.value].mainTitle;
    document.querySelector('.intro p').textContent = translations[langSelect.value].mainDesc;
    document.querySelector('.task-list h2').textContent = translations[langSelect.value].taskListTitle;
    document.querySelector('.priority-list h2').textContent = translations[langSelect.value].priorityTitle;
    document.querySelector('.matrix-container h2').textContent = translations[langSelect.value].graphTitle;
    
    // Save preferences
    saveUserPreferences();
  });
});

// Custom dropdown functionality
document.addEventListener('DOMContentLoaded', function() {
  const customSelect = document.querySelector('.custom-select');
  const selectedOption = customSelect.querySelector('.selected-option');
  const options = customSelect.querySelectorAll('.option');
  const langSelect = document.getElementById('langSelect');

  selectedOption.addEventListener('click', function() {
    customSelect.classList.toggle('active');
  });

  options.forEach(option => {
    option.addEventListener('click', function() {
      const value = this.getAttribute('data-value');
      const text = this.querySelector('span').textContent;
      const flag = this.querySelector('img').src;
      
      // Update selected option
      selectedOption.querySelector('span').textContent = text;
      selectedOption.querySelector('img').src = flag;
      
      // Update hidden select
      langSelect.value = value;
      
      // Trigger change event
      const event = new Event('change');
      langSelect.dispatchEvent(event);
      
      // Close dropdown
      customSelect.classList.remove('active');
    });
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!customSelect.contains(e.target)) {
      customSelect.classList.remove('active');
    }
  });
});

// B√∂lgeyi x ve y'ye g√∂re d√∂nd√ºren fonksiyon
function getRegionByXY(x, y) {
  if (x >= -5 && x <= 0 && y >= 0 && y <= 5) return '1'; // ≈ûimdi Yap
  if (x > 0 && x <= 5 && y >= 0 && y <= 5) return '2';   // Planla
  if (x >= -5 && x <= 0 && y >= -5 && y < 0) return '3'; // Delege Et
  if (x > 0 && x <= 5 && y >= -5 && y < 0) return '4';   // Sil
  return null;
}

function addTaskCardToUI(task, index) {
  const div = document.createElement('div');
  div.className = 'task';
  const titleRow = document.createElement('div');
  titleRow.className = 'title-row';
  const t = translations[langSelect.value];
  const isDark = document.body.classList.contains('dark');
  const editIcon = isDark ? 'images/icons/pen-dark mode.ico' : 'images/icons/pen-light-mode.ico';
  const trashIcon = isDark ? 'images/icons/trash-can-dark-mode.ico' : 'images/icons/trash-can-light-mode.ico';
  const strong = document.createElement('strong');
  strong.innerHTML = `${task.title} <button class="edit-btn" title="${t.editTask}"><img src="${editIcon}" alt="edit"></button>`;
  const trashBtn = document.createElement('button');
  trashBtn.className = 'trash-btn';
  trashBtn.title = 'Delete';
  trashBtn.innerHTML = `<img src="${trashIcon}" alt="delete">`;
  titleRow.appendChild(strong);
  titleRow.appendChild(trashBtn);

  // x ve y hesapla
  const x = task.urgency - 5;
  const y = task.importance - 5;
  const region = getRegionByXY(x, y);
  const regionLabel = document.createElement('span');
  regionLabel.className = 'task-region-label';
  regionLabel.textContent = t.regionExplanations[region];
  regionLabel.style.float = 'right';
  regionLabel.style.fontWeight = 'bold';
  regionLabel.style.marginLeft = 'auto';
  regionLabel.style.marginRight = '0.5em';
  regionLabel.style.color = isDark ? '#fff' : '#234';
  titleRow.appendChild(regionLabel);

  div.appendChild(titleRow);
  div.appendChild(createSlider(task, 'urgency', index));
  div.appendChild(createSlider(task, 'importance', index));
  document.getElementById('tasks').appendChild(div);
  // Eventler
  const editBtn = strong.querySelector('.edit-btn');
  editBtn.onclick = createEditHandler(task, div, t, editIcon);
  trashBtn.onclick = function() {
    showCustomAlert(t.deleteConfirm, () => {
      const idx = tasks.indexOf(task);
      if (idx > -1) {
        tasks.splice(idx, 1);
        div.remove();
        updateMatrix();
        updatePriorityList();
        saveUserPreferences();
        updateClearAllButtonVisibility();
      }
    });
  };
  div.onmouseenter = () => { window._highlightedTask = index; updateMatrix(); };
  div.onmouseleave = () => { window._highlightedTask = null; updateMatrix(); };
}
